# CSTrader - CS:GO Skin Marketplace

**CSTrader** Ã© uma aplicaÃ§Ã£o fullâ€‘stack distribuÃ­da para negociaÃ§Ã£o de skins de CS:GO. Inclui marketplace em tempo real, gestÃ£o de inventÃ¡rio, carteira de fundos e painel administrativo seguro.

---

## ğŸ—ï¸ Arquitetura

O sistema Ã© composto por Frontend (Nginx servindo ficheiros estÃ¡ticos) e Backend (FastAPI), expostos atravÃ©s de um Ingress Controller. A persistÃªncia Ã© feita com PostgreSQL em StatefulSet.

```mermaid
graph TD
    User((Utilizador)) -->|HTTP Request| Ingress[Ingress Controller]

    subgraph Kubernetes Cluster
        Ingress -->|/| Frontend[ServiÃ§o Frontend\n(Nginx)]
        Ingress -->|/api| Backend[ServiÃ§o Backend\n(FastAPI)]
        Backend -->|Read/Write| DB[(PostgreSQL\nStatefulSet)]
        Job[Admin Init Job] -.->|Seed Data| DB
        Migrations[Alembic Job] -.->|Schema Update| DB
    end
```

## ğŸš€ PrÃ©-requisitos

- Docker
- Minikube
- kubectl
- make

## âš¡ Quick Start

Os scripts do Make automatizam todo o ciclo (start do cluster, build das imagens, deploy, migraÃ§Ãµes e seed). Use os comandos abaixo conforme o caso.

Primeira instalaÃ§Ã£o (cria cluster, imagens, aplica infra, migra e cria admin):

```bash
make start_JARVIS
```

Se o Minikube jÃ¡ estiver a correr e quiser apenas reconstruir e reaplicar:

```bash
make run
```

O que `make start_JARVIS` faz (resumo):

- Inicia o Minikube
- Ativa addons (Ingress, Registry)
- ConstrÃ³i as imagens Docker (`cstrader:latest` e `cstrader-frontend:latest`)
- Carrega as imagens no Minikube
- Aplica os manifests (Database, API, Frontend)
- Configura regras de Ingress
- Executa migraÃ§Ãµes Alembic
- Cria o utilizador admin por defeito
- Inicia portâ€‘forwarding para acesso local

## ğŸ® Acesso

ApÃ³s o deploy (o passo `make deploy` verifica a aplicaÃ§Ã£o), o acesso local Ã© via portâ€‘forward:

- AplicaÃ§Ã£o: http://localhost:8080/
- Docs da API (Swagger): http://localhost:8080/api/docs

## ğŸ› ï¸ Comandos disponÃ­veis (Makefile)

- `make start_JARVIS` â€” Setup completo (cluster, imagens, deploy, migraÃ§Ãµes e seed).
- `make start` â€” Inicia o Minikube.
- `make images` â€” ConstrÃ³i imagens Docker e carrega no Minikube.
- `make db` â€” Aplica StatefulSet e Service do PostgreSQL.
- `make api` â€” Aplica o Backend, Secrets e Admin Job.
- `make apply_frontend` â€” Aplica o Frontend (Nginx) e ConfigMaps.
- `make ingress` â€” Aplica regras de Ingress.
- `make migrations` â€” Executa migraÃ§Ãµes Alembic dentro do pod.
- `make admin` â€” Re-executa o Job de inicializaÃ§Ã£o do admin.
- `make deploy` â€” Faz portâ€‘forward e valida endpoint.
- `make clean` â€” Remove o cluster Minikube (teardown).

## ğŸ” Credenciais do Admin (por defeito)

O sistema inicializa automaticamente uma conta de superâ€‘admin via `infra/backend/admin_job.yaml`.

- Email: `admin@cstrader.com`
- Password: definido em `infra/backend/admin-credentials.yaml` (ex.: `SuperSecureAdmin123!`)

> Nota: altere as credenciais em produÃ§Ã£o e guarde segredos num Secret do Kubernetes.

## ğŸ“‚ Estrutura do Projeto (resumo)

- `backend/` â€” AplicaÃ§Ã£o Python (FastAPI), Dockerfile e migraÃ§Ãµes Alembic.
- `frontend/` â€” Ficheiros estÃ¡ticos (HTML/JS/CSS) servidos pelo Nginx.
- `infra/` â€” Manifests Kubernetes (Deployments, Services, StatefulSets, Secrets, Ingress).
- `Makefile` â€” AutomaÃ§Ã£o para desenvolvimento e deploy.
